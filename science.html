<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Article Stream</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #f0f0f0; font-family: "PingFang SC", sans-serif; }
        #hint { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); 
                background: rgba(0,0,0,0.6); color: white; padding: 10px 20px; 
                border-radius: 20px; pointer-events: none; z-index: 100; font-size: 14px; }
    </style>
</head>
<body>
    <div id="hint">鼠标滚轮滚动 | 点击卡片：左键沉底 / 右键置顶</div>
    <script>
        // --- 初始化场景 ---
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setClearColor(0xeeeeee);
        document.body.appendChild(renderer.domElement);

        camera.position.set(0, 0, 10);
        const light = new THREE.AmbientLight(0xffffff, 0.8);
        scene.add(light);
        const pointLight = new THREE.PointLight(0xffffff, 0.5);
        pointLight.position.set(5, 5, 5);
        scene.add(pointLight);

        // --- 生成 20 个卡片数据 ---
        const cards = [];
        const cardGroup = new THREE.Group();
        scene.add(cardGroup);

        function createCardTexture(index) {
            const canvas = document.createElement('canvas');
            canvas.width = 512; canvas.height = 320;
            const ctx = canvas.getContext('2d');
            
            // 背景
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, 512, 320);
            
            // 模拟主图
            ctx.fillStyle = `hsl(${(index * 45) % 360}, 70%, 60%)`;
            ctx.fillRect(10, 10, 492, 200);
            
            // 标题
            ctx.fillStyle = '#333333';
            ctx.font = 'bold 28px sans-serif';
            ctx.fillText(`这是第 ${index + 1} 篇文章的标题`, 20, 245);
            
            // 简介
            ctx.fillStyle = '#888888';
            ctx.font = '20px sans-serif';
            ctx.fillText('这是一行简短的文章描述内容，仅展示一行...', 20, 285);
            
            return new THREE.CanvasTexture(canvas);
        }

        const CARD_HEIGHT = 3.2;
        const GAP = 0.2;

        for (let i = 0; i < 20; i++) {
            const geometry = new THREE.PlaneGeometry(5, CARD_HEIGHT);
            const material = new THREE.MeshStandardMaterial({ 
                map: createCardTexture(i),
                transparent: true,
                roughness: 0.3
            });
            const card = new THREE.Mesh(geometry, material);
            card.position.y = -i * (CARD_HEIGHT + GAP);
            card.userData = { index: i, active: true };
            cardGroup.add(card);
            cards.push(card);
        }

        // --- 交互逻辑 ---
        let scrollTarget = 0;
        let currentIndex = 0;

        // 滚轮控制上下
        window.addEventListener('wheel', (e) => {
            scrollTarget += e.deltaY * 0.005;
            scrollTarget = Math.max(0, Math.min(scrollTarget, (cards.length - 3) * (CARD_HEIGHT + GAP)));
        });

        // 模拟点击交互 (左键沉底，右键置顶)
        window.addEventListener('mousedown', (e) => {
            // 这里简单处理：点击当前的第一个卡片
            const activeCards = cards.filter(c => c.userData.active);
            if (activeCards.length === 0) return;
            const topCard = activeCards[0];

            if (e.button === 0) { // 左键：向左沉底
                topCard.userData.active = false;
                gsap.to(topCard.position, { x: -8, z: -5, y: topCard.position.y - 2, duration: 0.8, ease: "power2.inOut" });
                gsap.to(topCard.rotation, { y: 0.5, z: 0.2, duration: 0.8 });
                gsap.to(topCard.material, { opacity: 0, duration: 0.7 });
            } else if (e.button === 2) { // 右键：向右置顶
                topCard.userData.active = false;
                gsap.to(topCard.position, { x: 8, z: 5, y: topCard.position.y + 2, duration: 0.8, ease: "back.out" });
                gsap.to(topCard.rotation, { y: -0.5, duration: 0.8 });
                gsap.to(topCard.material, { opacity: 0, duration: 0.7 });
            }
        });
        window.addEventListener('contextmenu', e => e.preventDefault());

        // --- 渲染循环 ---
        function animate() {
            requestAnimationFrame(animate);
            
            // 平滑滚动效果
            cardGroup.position.y = THREE.MathUtils.lerp(cardGroup.position.y, scrollTarget, 0.1);
            
            // 简单的悬浮透视感
            cards.forEach(card => {
                if (card.userData.active) {
                    const dist = Math.abs(card.position.y - (cardGroup.position.y - 2));
                    // 越靠近中心越亮，模拟聚焦
                    card.material.emissive.setScalar(THREE.MathUtils.lerp(0.1, 0, dist * 0.2));
                }
            });

            renderer.render(scene, camera);
        }
        animate();

        // 窗口自适应
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
