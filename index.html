<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Xitoys.cn - æè‡´ç‰©ç†å¼•æ“ç‰ˆ</title>
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; }
        body, html { width: 100%; height: 100%; overflow: hidden; background: #ff5f8d; }

        .app-container {
            position: relative; width: 100%; height: 100%;
            background: radial-gradient(circle at 50% 50%, #ff85ad 0%, #ff5f8d 100%);
        }

        /* å·¨å¤§å“ç‰Œ Logo */
        .brand-header {
            position: absolute; top: 10%; width: 100%; text-align: center;
            z-index: 10; pointer-events: none;
        }
        .brand-header h1 {
            color: white; font-size: 20vw; font-weight: 900; font-style: italic;
            text-shadow: 0 10px 40px rgba(0,0,0,0.15); line-height: 1;
        }

        /* è‚¥çš‚æ³¡é«˜ä¿çœŸæ ·å¼ */
        .bubble-node {
            position: absolute; border-radius: 50%; display: flex;
            align-items: center; justify-content: center; color: white;
            text-decoration: none; font-weight: bold; text-align: center;
            border: 1.5px solid rgba(255,255,255,0.45);
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.7) 0%, rgba(255,255,255,0.1) 40%, rgba(135,206,250,0.2) 75%, rgba(255,20,147,0.25) 100%);
            box-shadow: inset -10px -10px 25px rgba(255,255,255,0.3), 0 15px 45px rgba(0,0,0,0.15);
            backdrop-filter: blur(4px); -webkit-backdrop-filter: blur(4px);
            z-index: 50; touch-action: none; will-change: transform;
        }

        /* å³ä¸‹è§’å·¨å¤§è´­ç‰©å…¥å£ */
        .giant-entrance {
            width: 320px !important; height: 320px !important; font-size: 32px;
            background: radial-gradient(circle at 35% 35%, rgba(255,255,255,0.8) 0%, rgba(255,200,0,0.25) 50%, rgba(255,0,80,0.4) 100%);
            position: fixed !important; right: -50px; bottom: -50px;
            z-index: 100; border: 3px solid rgba(255,255,255,0.5);
        }

        #electric-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 20; pointer-events: none; }
        .bubble-text { pointer-events: none; text-shadow: 0 2px 10px rgba(0,0,0,0.25); font-size: 16px; }
        .giant-entrance .bubble-text { font-size: 32px; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="brand-header"><h1>Xitoys</h1></div>
    <canvas id="electric-canvas"></canvas>
    <div id="bubble-stage"></div>
</div>

<script>
    const canvas = document.getElementById('electric-canvas');
    const ctx = canvas.getContext('2d');
    const stage = document.getElementById('bubble-stage');

    let w, h, bubbles = [];
    let activeDrag = null;

    const bubbleData = [
        { label: 'æ¬¢å–œæ•…äº‹', r: 70, url: '#' },
        { label: 'ä¸¤æ€§ç§‘æ™®', r: 80, url: '#' },
        { label: 'è§†é¢‘é¢‘é“', r: 65, url: '#' },
        { label: 'æˆ‘è¦æŠ•èµ„', r: 60, url: '#' },
        { label: 'ğŸ›’ åœ¨çº¿è´­ç‰©', r: 160, isMain: true, url: '#' }
    ];

    function init() {
        w = canvas.width = window.innerWidth;
        h = canvas.height = window.innerHeight;
        stage.innerHTML = '';
        bubbles = [];

        bubbleData.forEach((data, i) => {
            const el = document.createElement('div');
            el.className = 'bubble-node' + (data.isMain ? ' giant-entrance' : '');
            el.innerHTML = `<span class="bubble-text">${data.label}</span>`;
            stage.appendChild(el);

            // åˆå§‹æ•£æ”¾åæ ‡ï¼Œé¿å…é‡å 
            let startX = data.isMain ? w - 240 : (w/4 + (i%2)*w/2 + (Math.random()-0.5)*100);
            let startY = data.isMain ? h - 240 : (h/4 + Math.floor(i/2)*h/2 + (Math.random()-0.5)*100);

            const b = {
                el, r: data.r,
                x: startX, y: startY,
                vx: data.isMain ? 0 : (Math.random() - 0.5) * 3,
                vy: data.isMain ? 0 : (Math.random() - 0.5) * 3,
                mass: data.r,
                isMain: data.isMain || false,
                dragging: false
            };

            if (!data.isMain) {
                el.addEventListener('touchstart', (e) => {
                    activeDrag = b;
                    b.dragging = true;
                    b.vx = b.vy = 0;
                }, {passive: true});
            }
            bubbles.push(b);
        });
    }

    // æ ¸å¿ƒç‰©ç†ï¼šåœ†å‘¨å¼¹æ€§ç¢°æ’ç®—æ³•
    function checkCollisions() {
        for (let i = 0; i < bubbles.length; i++) {
            for (let j = i + 1; j < bubbles.length; j++) {
                const b1 = bubbles[i];
                const b2 = bubbles[j];
                const dx = b2.x - b1.x;
                const dy = b2.y - b1.y;
                const dist = Math.sqrt(dx * dx + dy * dy);
                const minDist = b1.r + b2.r;

                if (dist < minDist) {
                    // 1. é™æ€çº æ­£ï¼šé˜²æ­¢æ°”æ³¡é‡å é™·è¿›å»
                    const overlap = minDist - dist;
                    const nx = dx / dist;
                    const ny = dy / dist;
                    
                    if (!b1.isMain && !b1.dragging) {
                        b1.x -= nx * overlap * 0.5;
                        b1.y -= ny * overlap * 0.5;
                    }
                    if (!b2.isMain && !b2.dragging) {
                        b2.x += nx * overlap * 0.5;
                        b2.y += ny * overlap * 0.5;
                    }

                    // 2. åŠ¨é‡äº¤æ¢ï¼šäº§ç”Ÿæ’å‡»åå¼¹æ•ˆæœ
                    const vRelativeX = b1.vx - b2.vx;
                    const vRelativeY = b1.vy - b2.vy;
                    const vDotN = vRelativeX * nx + vRelativeY * ny;

                    if (vDotN > 0) {
                        const impulse = (2 * vDotN) / (b1.mass + b2.mass);
                        if (!b1.isMain && !b1.dragging) {
                            b1.vx -= impulse * b2.mass * nx;
                            b1.vy -= impulse * b2.mass * ny;
                        }
                        if (!b2.isMain && !b2.dragging) {
                            b2.vx += impulse * b1.mass * nx;
                            b2.vy += impulse * b1.mass * ny;
                        }
                    }
                }
            }
        }
    }

    function drawLightning() {
        ctx.clearRect(0, 0, w, h);
        bubbles.forEach((b1, i) => {
            bubbles.slice(i + 1).forEach(b2 => {
                const dx = b2.x - b1.x;
                const dy = b2.y - b1.y;
                const d = Math.sqrt(dx*dx + dy*dy);
                if (d < 450) {
                    ctx.beginPath();
                    ctx.moveTo(b1.x, b1.y);
                    let segs = 6;
                    for(let k=1; k<segs; k++) {
                        ctx.lineTo(b1.x + dx*k/segs + (Math.random()-0.5)*40, b1.y + dy*k/segs + (Math.random()-0.5)*40);
                    }
                    ctx.lineTo(b2.x, b2.y);
                    ctx.strokeStyle = `rgba(255, 255, 255, ${0.5 * (1-d/450)})`;
                    ctx.lineWidth = 1.5;
                    ctx.stroke();
                }
            });
        });
    }

    window.addEventListener('touchmove', (e) => {
        if (activeDrag) {
            const t = e.touches[0];
            activeDrag.x = t.clientX;
            activeDrag.y = t.clientY;
        }
    }, {passive: false});

    window.addEventListener('touchend', () => {
        if (activeDrag) activeDrag.dragging = false;
        activeDrag = null;
    });

    function update() {
        bubbles.forEach(b => {
            if (!b.dragging && !b.isMain) {
                b.x += b.vx; b.y += b.vy;
                // è¾¹ç•Œåå¼¹
                if (b.x < b.r || b.x > w - b.r) b.vx *= -1;
                if (b.y < b.r + 120 || b.y > h - b.r) b.vy *= -1;
            }
            // ä½¿ç”¨ translate3d ä¿è¯æµç•…åº¦
            b.el.style.transform = `translate3d(${b.x - b.r}px, ${b.y - b.r}px, 0)`;
        });

        checkCollisions();
        drawLightning();
        requestAnimationFrame(update);
    }

    window.addEventListener('resize', init);
    init();
    update();
</script>
</body>
</html>
